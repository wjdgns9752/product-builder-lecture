<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="웹에서 바로 사용하는 실시간 환경 소음 측정기 (층간소음, 항공기, 도로, 철도). 데시벨(dB) 측정, 소음 기록 저장, 분야별 법적 기준 정보를 제공합니다. 별도의 설치 없이 마이크로 간편하게 측정하세요.">
    <meta name="keywords" content="소음 측정기, 층간소음, 항공기 소음, 도로교통 소음, 철도 소음, 데시벨 측정, 소음 기준">
    <meta property="og:title" content="스마트 환경 소음 모니터 - 실시간 데시벨 측정">
    <meta property="og:description" content="설치 없는 무료 소음 측정기. 층간소음, 항공기, 교통 소음 기록 및 분석 기능을 제공합니다.">
    <meta property="og:type" content="website">
    
    <title>스마트 환경 소음 모니터 (층간/항공/도로/철도) | 실시간 dB 측정</title>
    
    <link rel="stylesheet" href="style.css?v=14">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🔊</text></svg>">
    
    <!-- Google AdSense -->
    <meta name="google-adsense-account" content="ca-pub-4494575673591119">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4494575673591119"
     crossorigin="anonymous"></script>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">🔊 Environmental Noise Monitor</div>
        </div>
    </header>

    <main class="container">
        <!-- Main Tool Section -->
        <section class="tool-section">
            <h1>실시간 환경 소음 모니터링</h1>
            <p class="subtitle">마이크를 통해 층간소음, 항공기, 도로, 철도 소음을 측정하고 기준을 확인하세요.</p>
            
            <canvas id="visualizer" width="600" height="100"></canvas>
            
            <!-- Noise Classification UI -->
            <div class="classifier-container">
                <h3>🔍 소음원 분석 (실시간)</h3>
                <div class="class-grid">
                    <div class="class-card" id="type-floor">
                        <div class="icon">👣</div>
                        <div class="label">층간소음</div>
                        <div class="sub">저주파/충격</div>
                    </div>
                    <div class="class-card" id="type-home">
                        <div class="icon">🏠</div>
                        <div class="label">생활소음</div>
                        <div class="sub">대화/TV</div>
                    </div>
                    <div class="class-card" id="type-road">
                        <div class="icon">🚗</div>
                        <div class="label">도로교통</div>
                        <div class="sub">지속음</div>
                    </div>
                    <div class="class-card" id="type-train">
                        <div class="icon">🚆</div>
                        <div class="label">철도/지하철</div>
                        <div class="sub">진동/마찰</div>
                    </div>
                    <div class="class-card" id="type-air">
                        <div class="icon">✈️</div>
                        <div class="label">항공기</div>
                        <div class="sub">상공 통과</div>
                    </div>
                </div>
                <p class="algo-note">* 주파수 대역 분석 기반 추정값입니다. (AI 정밀 분석 아님)</p>
            </div>
            
            <div class="status-panel">
                <h2 id="status-text">상태: 대기 중</h2>
                
                <div class="info-text">
                    <span>현재 소음: <span id="current-vol">0</span> dB (상대값)</span>
                    <span>배경 소음: <span id="bg-vol">0</span></span>
                </div>
                
                <div class="meter-container">
                    <div id="bg-marker"></div>
                    <div id="meter-bar"></div>
                </div>

                <div class="duration-container">
                    <div class="duration-label">지속 시간 감지</div>
                    <div class="duration-track">
                        <div id="duration-bar"></div>
                    </div>
                </div>
            </div>

            <!-- Advanced Analysis Dashboard (Harmonica & Event) -->
            <div class="analysis-dashboard">
                <h3>📊 소음 성향 정밀 분석 (Harmonica & Event)</h3>
                
                <div class="harmonica-visual">
                    <div class="harmonica-bar-container">
                        <!-- Background Component (L90) -->
                        <div id="harmonica-base" class="h-bar base">
                            <span class="h-label">배경(L90)</span>
                        </div>
                        <!-- Event Component (Leq - L90) -->
                        <div id="harmonica-event" class="h-bar event">
                            <span class="h-label">돌발(Event)</span>
                        </div>
                    </div>
                    <div class="harmonica-scale">
                        <span>30dB</span>
                        <span>60dB</span>
                        <span>90dB</span>
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-box">
                        <span class="m-label">배경 소음도 (L90)</span>
                        <span class="m-value" id="val-l90">-</span>
                        <span class="m-unit">dB</span>
                    </div>
                    <div class="metric-box highlight">
                        <span class="m-label">돌발 영향력 (Intrusiveness)</span>
                        <span class="m-value" id="val-event">-</span>
                        <span class="m-unit">dB</span>
                    </div>
                    <div class="metric-box">
                        <span class="m-label">변동성 (Fluctuation)</span>
                        <span class="m-value" id="val-ir">-</span>
                        <span class="m-unit">%</span>
                    </div>
                </div>

                <div class="analysis-comment-box">
                    <span id="noise-badge" class="badge">분석 중...</span>
                    <p id="analysis-comment">최근 30초 간의 소음 패턴을 분석하고 있습니다.</p>
                </div>
            </div>

            <div class="controls">
                <button id="init-btn" class="primary-btn">모니터링 시작</button>
                <button id="record-btn" class="record-btn hidden">🔴 녹음 시작</button>
            </div>

            <div class="settings">
                <h3>설정 (Sensitivity)</h3>
                <div class="desc">알림 임계값 조절 (배경 소음 대비 민감도)</div>
                <div class="slider-wrapper">
                    <input type="range" id="threshold" min="10" max="100" value="50">
                    <span id="threshold-val">50</span>%
                </div>
                
            <br>
            <button id="calibration-btn" class="secondary-btn">🎙️ 마이크 보정 (Calibration)</button>
            <br>
            <label>
                <input type="checkbox" id="audio-alarm" checked>
                알림음 켜기
            </label>
        </div>

        <button id="theme-toggle" class="theme-btn">테마 변경</button>
    </section>

    <!-- ... (Previous Info Section) ... -->

    <!-- Calibration Modal -->
    <div id="calibration-modal" class="modal hidden">
        <div class="modal-content">
            <h2>마이크 보정</h2>
            <p class="desc">정확한 측정을 위해 기준점을 설정합니다.</p>
            
            <div class="calib-step">
                <span class="step-num">1</span>
                <p>핑크 노이즈를 재생하여 일정한 소음 환경을 만드세요.<br>(또는 조용한 방이라면 생략 가능)</p>
                <button id="play-noise-btn">🔊 핑크 노이즈 재생/중지</button>
            </div>

            <div class="calib-step">
                <span class="step-num">2</span>
                <p><strong>자동 정밀 보정 (권장)</strong></p>
                <p class="sub-desc">정확도를 위해 3회 반복 측정하여 평균값을 적용합니다.<br>휴대폰을 조용한 곳에 두고 시작하세요.</p>
                <button id="auto-calib-btn" class="primary-btn" style="width:100%">🚀 정밀 자동 보정 시작 (3회)</button>
                
                <div class="calib-divider">
                    <span>또는 수동 입력</span>
                </div>

                <div class="input-group" style="justify-content: center;">
                    <input type="number" id="real-db-input" placeholder="예: 60" min="30" max="120">
                    <span>dB (소음계 측정값)</span>
                </div>
            </div>

            <div class="calib-step">
                <span class="step-num">3</span>
                <p>현재 웹 앱 측정값: <span id="current-raw-db">...</span> dBFS</p>
            </div>

            <div class="btn-group">
                <button id="cancel-calib" class="secondary-btn">취소</button>
                <button id="save-calib" class="primary-btn">보정값 저장</button>
            </div>
        </div>
    </div>

        <!-- Content Section for AdSense Quality -->
        <article class="info-section">
            <hr class="divider">
            
            <section class="content-block">
                <h2>층간소음과 데시벨(dB) 이해하기</h2>
                <p>
                    최근 공동주택 생활이 늘어나면서 층간소음 문제는 심각한 사회적 이슈가 되고 있습니다. 
                    이 웹 도구는 사용자의 마이크를 활용하여 현재 환경의 소음 변화를 시각화하고, 
                    갑작스러운 소음 발생을 감지하여 기록하는 데 도움을 줍니다.
                </p>
            </section>

            <section class="content-block">
                <h3>📢 소음의 크기별 예시 (dB)</h3>
                <ul class="db-list">
                    <li><strong>30dB:</strong> 속삭이는 소리, 심야의 교외</li>
                    <li><strong>40dB:</strong> 조용한 도서관, 주간의 주택가</li>
                    <li><strong>50dB:</strong> 조용한 사무실, 일반적인 빗소리</li>
                    <li><strong>60dB:</strong> 일상적인 대화 소리, 백화점 내부</li>
                    <li><strong>70dB:</strong> 시끄러운 사무실, 전화벨 소리</li>
                    <li><strong>80dB:</strong> 지하철 차내 소음, 진공청소기</li>
                    <li><strong>90dB 이상:</strong> 소음성 난청을 유발할 수 있는 수준</li>
                </ul>
                <p class="note">* 본 웹 앱의 측정값은 전문 장비가 아닌 기기 마이크를 사용하므로, 상대적인 참고용으로만 사용하시기 바랍니다.</p>
            </section>

            <section class="content-block">
                <h3>⚖️ 환경 소음별 관리 기준 (참고용)</h3>
                <p>소음의 종류에 따라 적용되는 법적 기준이 다릅니다. 아래 기준을 참고하여 현재 소음 수준을 확인해보세요.</p>
                
                <div class="standard-grid">
                    <div class="std-card">
                        <h4>🏠 층간소음</h4>
                        <p class="std-desc">공동주택 층간소음 규칙</p>
                        <ul>
                            <li><strong>주간:</strong> 39dB (1분 등가)</li>
                            <li><strong>야간:</strong> 34dB (1분 등가)</li>
                            <li><small>* 직접충격음 기준</small></li>
                        </ul>
                    </div>
                    <div class="std-card">
                        <h4>🚗 도로교통 소음</h4>
                        <p class="std-desc">소음·진동 관리법 (주거지역)</p>
                        <ul>
                            <li><strong>주간:</strong> 68dB 이하</li>
                            <li><strong>야간:</strong> 58dB 이하</li>
                            <li><small>* 도로변 주거지 기준</small></li>
                        </ul>
                    </div>
                    <div class="std-card">
                        <h4>🚆 철도 소음</h4>
                        <p class="std-desc">철도 소음 한도 (주거지역)</p>
                        <ul>
                            <li><strong>주간:</strong> 70dB 이하</li>
                            <li><strong>야간:</strong> 60dB 이하</li>
                        </ul>
                    </div>
                    <div class="std-card">
                        <h4>✈️ 항공기 소음</h4>
                        <p class="std-desc">공항 소음 방지법</p>
                        <ul>
                            <li><strong>피해 예상:</strong> 75 WECPNL↑</li>
                            <li><strong>대책 기준:</strong> 약 70~75dB</li>
                            <li><small>* 지역/공항별 상이</small></li>
                        </ul>
                    </div>
                </div>
            </section>

            <section class="content-block">
                <h3>💡 효과적인 소음 모니터링 방법</h3>
                <ol>
                    <li>조용한 상태에서 '모니터링 시작'을 눌러 배경 소음을 학습시킵니다.</li>
                    <li>소음이 발생했을 때 그래프가 급격히 상승하는지 확인합니다.</li>
                    <li>지속적인 소음이 감지되면 자동으로 평가 창이 뜹니다.</li>
                    <li>기록된 데이터를 통해 소음 빈도를 체크해보세요.</li>
                </ol>
            </section>
        </article>
    </main>

    <footer>
        <div class="footer-content">
            <p>&copy; 2024 Noise Monitor. All rights reserved.</p>
            <div class="footer-links">
                <a href="#" onclick="alert('개인정보처리방침: 본 서비스는 사용자의 오디오 데이터를 서버로 자동 전송하거나 저장하지 않습니다. 모든 오디오 처리는 브라우저 내에서 이루어지며, 녹음된 파일은 사용자의 기기에만 임시 저장(다운로드 가능)됩니다. 평가 데이터(점수, 시간, 태그)만 통계 목적으로 익명 저장됩니다.')">개인정보처리방침</a>
                <a href="#">이용약관</a>
                <a href="#" id="admin-mode-btn">관리자/실험 모드</a>
            </div>
            <p class="disclaimer">본 서비스는 법적 효력이 있는 측정 도구가 아닙니다. 정확한 측정은 전문 소음계(Sound Level Meter)를 사용하시기 바랍니다.</p>
        </div>
    </footer>

    <!-- Admin/Experiment Modal -->
    <div id="admin-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px;">
            <h2>🛠️ 관리자 실험실 (Admin Lab)</h2>
            <p class="desc">전문 소음계(SLM)와 웹 앱의 측정값을 비교하여<br>정밀도를 검증하고 오차를 분석합니다.</p>
            
            <div class="survey-section" style="background: #f5f5f5; padding: 15px; border-radius: 8px;">
                <div class="input-group" style="justify-content: space-between; margin-bottom: 10px;">
                    <label>📱 앱 측정값 (현재)</label>
                    <span id="admin-app-db" style="font-weight:bold; font-size:1.2rem; color:var(--primary-color);">0.0</span> dB
                </div>
                <div class="input-group" style="justify-content: space-between;">
                    <label>📟 소음계 측정값 (입력)</label>
                    <input type="number" id="admin-ref-db" placeholder="예: 65.5" style="width: 100px; font-size: 1.1rem;"> dB
                </div>
                <button id="admin-log-btn" class="primary-btn" style="width:100%; margin-top:15px;">📊 데이터 기록 및 비교</button>
            </div>

            <div class="data-log-section" style="margin-top: 20px; text-align: left;">
                <h3>📋 비교 기록 (Log)</h3>
                <div style="max-height: 200px; overflow-y: auto; font-size: 0.9rem; border: 1px solid #ddd;">
                    <table style="width:100%; border-collapse: collapse;">
                        <thead style="background: #eee;">
                            <tr>
                                <th style="padding:8px;">#</th>
                                <th style="padding:8px;">App(dB)</th>
                                <th style="padding:8px;">Ref(dB)</th>
                                <th style="padding:8px;">오차</th>
                            </tr>
                        </thead>
                        <tbody id="admin-log-table">
                            <!-- Logs go here -->
                        </tbody>
                    </table>
                </div>
                <div class="stats-summary" style="margin-top: 10px; font-weight: bold; text-align: right;">
                    평균 오차(MAE): <span id="admin-mae">0.0</span> dB
                </div>
            </div>

            <button onclick="document.getElementById('admin-modal').classList.add('hidden')" class="secondary-btn" style="margin-top: 20px;">닫기</button>
        </div>
    </div>

    <!-- Evaluation Modal -->
    <div id="evaluation-modal" class="modal hidden">
        <div class="modal-content">
            <h2>소음 평가 (EMA)</h2>
            <p>방금 발생한 소음이 얼마나 거슬렸나요?</p>
            
            <div class="audio-preview-section" id="audio-preview-container" style="display:none; margin-bottom: 20px; padding: 15px; background: #f0f0f0; border-radius: 8px;">
                <label style="display:block; margin-bottom:10px; font-weight:bold;">🎤 녹음된 소음 확인</label>
                <audio id="noise-player" controls style="width:100%; margin-bottom:10px;"></audio>
                <a id="download-recording" href="#" class="secondary-btn" style="display:inline-block; font-size:0.9rem; text-decoration:none;">💾 녹음 파일 다운로드</a>
            </div>
            
            <div class="survey-section">
                <label>1. 불쾌감 정도 (1-10)</label>
                <div class="rating-scale">
                    <button class="rate-btn" data-val="1">1</button>
                    <button class="rate-btn" data-val="2">2</button>
                    <button class="rate-btn" data-val="3">3</button>
                    <button class="rate-btn" data-val="4">4</button>
                    <button class="rate-btn" data-val="5">5</button>
                    <button class="rate-btn" data-val="6">6</button>
                    <button class="rate-btn" data-val="7">7</button>
                    <button class="rate-btn" data-val="8">8</button>
                    <button class="rate-btn" data-val="9">9</button>
                    <button class="rate-btn" data-val="10">10</button>
                </div>
                <div class="selected-rating">선택함: <span id="selected-val">-</span></div>
            </div>

            <div class="survey-section">
                <label>2. 현재 활동 (Activity)</label>
                <div class="chip-group" id="activity-chips">
                    <button class="chip" data-type="activity" data-val="working">일/학습</button>
                    <button class="chip" data-type="activity" data-val="relaxing">휴식</button>
                    <button class="chip" data-type="activity" data-val="sleeping">수면</button>
                    <button class="chip" data-type="activity" data-val="housework">가사</button>
                </div>
            </div>

            <div class="survey-section">
                <label>3. 정답 레이블링 (AI 학습 데이터용)</label>
                <div class="chip-group" id="source-chips">
                    <button class="chip" data-type="source" data-val="footsteps">층간소음(발소리)</button>
                    <button class="chip" data-type="source" data-val="traffic">도로/차량</button>
                    <button class="chip" data-type="source" data-val="aircraft">항공기</button>
                    <button class="chip" data-type="source" data-val="train">철도/지하철</button>
                    <button class="chip" data-type="source" data-val="construction">공사소음</button>
                    <button class="chip" data-type="source" data-val="voice">사람/동물</button>
                </div>
            </div>

            <button id="submit-eval" disabled>제출 및 계속하기</button>
        </div>
    </div>

    <!-- Onboarding Modal (User Info) -->
    <div id="user-info-modal" class="modal">
        <div class="modal-content">
            <h2>👋 환영합니다!</h2>
            <p class="desc">정확한 소음 분석을 위해<br>기본 환경 정보를 입력해주세요.</p>
            
            <form id="user-info-form">
                <div class="survey-section">
                    <label>🏠 거주 형태</label>
                    <select id="housing-type" class="full-select">
                        <option value="apartment">아파트</option>
                        <option value="officetel">오피스텔</option>
                        <option value="villa">빌라/다세대</option>
                        <option value="house">단독주택</option>
                    </select>
                </div>

                <div class="survey-section">
                    <label>🏢 거주 층수</label>
                    <select id="floor-level" class="full-select">
                        <option value="low">저층 (1~3층)</option>
                        <option value="mid">중층 (4~10층)</option>
                        <option value="high">고층 (11층 이상)</option>
                        <option value="top">최상층 (탑층)</option>
                        <option value="semi-basement">반지하/지하</option>
                    </select>
                </div>

                <div class="survey-section">
                    <label>🌳 주변 환경 (주 소음원)</label>
                    <select id="env-type" class="full-select">
                        <option value="residential">일반 주택가 (조용함)</option>
                        <option value="roadside">도로변 (차량 소음)</option>
                        <option value="railway">철도/지하철 인근</option>
                        <option value="construction">공사장/상가 인근</option>
                        <option value="airport">공항/항로 인근</option>
                    </select>
                </div>

                <button type="button" onclick="saveUserInfo()" class="primary-btn" style="width:100%">입력 완료 및 시작</button>
            </form>
            <p class="algo-note" style="margin-top:15px">입력된 정보는 통계 분석용으로만 사용되며,<br>익명으로 안전하게 처리됩니다.</p>
        </div>
    </div>

    <script>
        // Global Onboarding Handler (Inline for safety)
        function saveUserInfo() {
            console.log("Saving user info (Inline)...");
            
            try {
                const housingType = document.getElementById('housing-type').value;
                const floorLevel = document.getElementById('floor-level').value;
                const envType = document.getElementById('env-type').value;

                const userProfile = {
                    housingType: housingType,
                    floorLevel: floorLevel,
                    envType: envType,
                    createdAt: new Date().toISOString()
                };
                
                localStorage.setItem('user_profile', JSON.stringify(userProfile));
            } catch (e) {
                console.error("Storage error:", e);
            }

            // Force Hide Modal
            const modal = document.getElementById('user-info-modal');
            if (modal) {
                modal.style.display = 'none';
                modal.classList.add('hidden');
            }
            
            alert('설정이 완료되었습니다.\n이제 [모니터링 시작] 버튼을 눌러주세요.');
        }

        // Check on load (Inline)
        window.addEventListener('DOMContentLoaded', () => {
            try {
                const profile = localStorage.getItem('user_profile');
                const modal = document.getElementById('user-info-modal');
                if (!profile && modal) {
                    modal.style.display = 'flex';
                } else if (modal) {
                    modal.style.display = 'none';
                }
            } catch(e) {}
        });
    </script>

    <!-- Permission Guide Modal -->
    <div id="permission-modal" class="modal hidden" style="z-index: 2000;">
        <div class="modal-content">
            <h2 style="color:#f44336">⚠️ 마이크 권한 필요</h2>
            <p>소음을 측정하기 위해 마이크 권한이 차단되었습니다.<br>아래 방법으로 권한을 허용해주세요.</p>
            
            <div style="text-align:left; background:#eee; padding:15px; border-radius:8px; margin:15px 0; font-size:0.9rem;">
                <strong>해결 방법:</strong>
                <ol style="margin:10px 0; padding-left:20px;">
                    <li>브라우저 주소창 왼쪽의 <strong>🔒 자물쇠 아이콘</strong> 클릭</li>
                    <li><strong>권한(Permissions)</strong> 또는 <strong>사이트 설정</strong> 클릭</li>
                    <li>마이크(Microphone)를 <strong>'허용(Allow)'</strong>으로 변경</li>
                    <li>페이지 <strong>새로고침</strong></li>
                </ol>
            </div>
            
            <button onclick="location.reload()" class="primary-btn" style="width:100%">확인 후 새로고침</button>
        </div>
    </div>

    <script type="module" src="main.js?v=14"></script>
</body>
</html>